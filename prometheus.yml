# Prometheus Configuration for Media Hardening Stack
# Monitors media processor, system metrics, and security events

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'media-hardening'
    environment: 'production'

# Alertmanager configuration (optional)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - alertmanager:9093

# Load rules from files
rule_files:
  # - "alert_rules.yml"

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          component: 'monitoring'

  # Media processor application metrics
  - job_name: 'media-processor'
    scrape_interval: 10s
    static_configs:
      - targets: ['media-processor:8080']
        labels:
          app: 'media-processor'
          version: 'v1'
    metrics_path: '/metrics'

    # Relabel to track container restarts
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance

  # Node exporter for system metrics (if deployed)
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']
        labels:
          component: 'system'

  # cAdvisor for container metrics (if deployed)
  - job_name: 'cadvisor'
    scrape_interval: 15s
    static_configs:
      - targets: ['cadvisor:8080']
        labels:
          component: 'containers'

# Storage configuration
storage:
  tsdb:
    retention.time: 30d
    retention.size: 10GB

# Remote write for long-term storage (optional)
# remote_write:
#   - url: "https://prometheus-remote-storage:9090/api/v1/write"
#     queue_config:
#       capacity: 10000
#       max_shards: 50
#       min_shards: 1
#       max_samples_per_send: 5000
#       batch_send_deadline: 5s
#       min_backoff: 30ms
#       max_backoff: 100ms
